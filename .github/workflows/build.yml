name: Build

on:
  push:
    branches:
      - master
    paths:
      - 'package.json'

jobs:
  build:
    if: contains(github.event.head_commit.message, '[build]')

    name: Build Poker and draft Release
    runs-on: ubuntu-latest

    steps:
      - name: Use Node.js
        uses: actions/setup-node@v1
        with:
          node-version: '16'

      - name: Copy Repo Files
        uses: actions/checkout@v2

      - name: Install Modules
        run: yarn

      - name: Lint
        run: yarn lint-strict

      - name: TSC
        run: yarn tsc --noEmit

      - name: Build Poker
        env:
          NODE_ENV: production
        run: yarn build

      - name: Create poker.zip
        run: |
          mv build poker
          zip -r poker.zip ./poker

      - name: get-npm-version
        id: package-version
        uses: martinbeentjes/npm-get-version-action@main

      - name: Create semver tag
        uses: EndBug/latest-tag@latest
        with:
          ref: v${{ steps.package-version.outputs.current-version}}

      - name: Draft Release
        uses: softprops/action-gh-release@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          tag_name: v${{ steps.package-version.outputs.current-version}}
          draft: true
          name: v${{ steps.package-version.outputs.current-version}}
          body: |
            ## â¬ å®‰è£…æ–¹å¼
            
            ä½œè€…ç›®å‰è¿˜æ²¡æœ‰æäº¤åˆ° Chrome Store ä¸Šï¼Œæ‰€ä»¥ç›®å‰çš„å‘å¸ƒè¿˜å¹¶ä¸æ˜¯ crx æ–‡ä»¶ï¼Œè€Œæ˜¯ zip æ–‡ä»¶ï¼Œå®‰è£…æ–¹å¼æœ‰ç‚¹å·®å¼‚ï¼š
            
            1. å…ˆæ‰“å¼€ Chromeï¼Œåœ¨åœ°å€æ è¾“å…¥ chrome://extensions åè¿›å…¥æ‰©å±•ç¨‹åºç®¡ç†é¡µé¢
            1. å¯ç”¨é¡µé¢å³ä¸Šè§’çš„ã€Œå¼€å‘è€…æ¨¡å¼ã€
            1. ç„¶åè§£å‹ poker.zip ï¼Œå°†è§£å‹å‡ºæ¥çš„æ–‡ä»¶å¤¹æ‹–æ‹½åˆ°è¿™ä¸ªé¡µé¢ä¸Šï¼Œå³å¯å®Œæˆå®‰è£…
            
            ## ğŸ†• æ›´æ–°ç‚¹
            
            - **ä¿®æ­£** AA
            - **ä¼˜åŒ–** BB
            - **æ–°å¢** CC
            
            ## ğŸ˜®â€ğŸ’¨ å·²çŸ¥é—®é¢˜
            
            - AA

          files: |
            LICENSE
            poker.zip
