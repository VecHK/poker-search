name: Build

on:
  push:
    branches:
      - master
    paths:
      - 'package.json'

jobs:
  build:
    if: contains(github.event.head_commit.message, '[build]')

    name: Build Poker and draft Release
    runs-on: ubuntu-latest

    steps:
      - name: Use Node.js
        uses: actions/setup-node@v1
        with:
          node-version: '16'

      - name: Copy Repo Files
        uses: actions/checkout@v2

      - name: Install Modules
        run: yarn

      - name: Lint
        run: yarn lint-strict

      - name: TSC
        run: yarn tsc --noEmit

      - name: Build Poker
        env:
          NODE_ENV: production
        run: yarn build

      - name: Create poker.zip
        run: |
          mv build poker
          zip -r poker.zip ./poker

      - name: get-npm-version
        id: package-version
        uses: martinbeentjes/npm-get-version-action@main

      - name: Create semver tag
        uses: EndBug/latest-tag@latest
        with:
          ref: v${{ steps.package-version.outputs.current-version}}

      - name: Draft Release
        uses: softprops/action-gh-release@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          tag_name: v${{ steps.package-version.outputs.current-version}}
          draft: true
          name: v${{ steps.package-version.outputs.current-version}}
          body: |
            ## â¬ å®‰è£…æ–¹å¼

            å®‰è£…æ–¹å¼æœ‰ä¸¤ç§ï¼Œ ä¸€ç§æ˜¯å» Chrome çš„ [Web Store](https://chrome.google.com/webstore/detail/poker-search/oojeodibjbmkclnocinjolfaigheengg) ä¸Šä¸‹è½½ï¼›å¦ä¸€ç§æ˜¯ä¸‹è½½è¿™ä¸ª Release æ¡ç›®ä¸‹çš„ zip æ–‡ä»¶æ¥å®‰è£…ã€‚

            zip æ–‡ä»¶æ–‡ä»¶çš„å®‰è£…æ–¹å¼ä¼šéº»çƒ¦ä¸€äº›ï¼Œä½ éœ€è¦è¿›è¡Œå¦‚ä¸‹æ­¥éª¤ï¼š

            1. å…ˆæ‰“å¼€ Chromeï¼Œåœ¨åœ°å€æ è¾“å…¥ chrome://extensions åè¿›å…¥æ‰©å±•ç¨‹åºç®¡ç†é¡µé¢
            1. å¯ç”¨é¡µé¢å³ä¸Šè§’çš„ã€Œå¼€å‘è€…æ¨¡å¼ã€
            1. ç„¶åè§£å‹ poker.zip ï¼Œå°†è§£å‹å‡ºæ¥çš„æ–‡ä»¶å¤¹æ‹–æ‹½åˆ°è¿™ä¸ªé¡µé¢ä¸Šï¼Œå³å¯å®Œæˆå®‰è£…

            ä¸¤ç§å®‰è£…æ–¹å¼ä¼¼ä¹æ˜¯æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«çš„ï¼Œä¸è¿‡å› ä¸ºè°·æ­Œå®¡æ ¸çš„åŸå› ï¼Œ Web Store çš„æ›´æ–°éƒ½ä¼šç¨æ…¢ä¸€äº›ã€‚

            ## ğŸ†• æ›´æ–°ç‚¹

            - **ä¿®æ­£** AA
            - **ä¼˜åŒ–** BB
            - **æ–°å¢** CC

            ## ğŸ˜®â€ğŸ’¨ å·²çŸ¥é—®é¢˜

            - AA

          files: |
            LICENSE
            poker.zip
